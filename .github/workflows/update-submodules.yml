name: Update submodules to latest main

on:
  schedule:
    - cron: "*/30 * * * *"   # 每 30 分钟检查一次
  workflow_dispatch:         # 支持手动触发
  push:
    branches:
      - main                 # 当 main 有提交时也试图同步 submodules

jobs:
  update-submodules:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout main repo
      uses: actions/checkout@v4
      with:
        submodules: true
        token: ${{ secrets.GITHUB_TOKEN }}

    - name: Pull latest commits for all submodules
      run: |
        git submodule foreach 'git fetch origin main && git checkout main && git pull origin main'

    - name: Commit & push the submodule updates
      run: |
        git config user.name "github-actions"
        git config user.email "github-actions@github.com"
        git add .
        git commit -m "Auto-update submodules to latest main" || echo "No updates"
        git push
